webpackJsonp([21],{"5vcS":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("0qgA"),s=o("oAV5"),n=o("w3CS"),r={name:"roleform",components:{formFile:o("gnUw").a},props:{formId:{type:String,default:""}},data:function(){var e=this;return{defaultProps:{id:"id",children:"children",label:"title"},defaultOfficeProps:{id:"id",children:"children",label:"name"},option:{name:"角色",apiName:"role",callback:{initCallback:function(){e.$store.dispatch("menu_getMenuTree","1").then(function(t){e.menuTree=e.$store.state.menu.menuTree;e.$store.dispatch("office_getOfficeTree",{type:"",extId:""}).then(function(){e.officeTree=e.$store.state.office.officeTree,e.$store.dispatch("role_getRoleInfo",e.formId).then(function(){e.option.formObject=e.$store.state.role.roleInfo;var t=_.cloneDeep(e.option.formObject);if(void 0!=t.menuIds&&void 0!=e.menuTree&&e.menuTree.length>0){var o=t.menuIds.split(","),i=[];void 0!=e.menuTree&&e.menuTree.length>0&&Object(s.m)(e.menuTree,i),void 0!=e.$refs.treeRole&&e.$refs.treeRole.setCheckedKeys(_.difference(o,i))}if(void 0!=t.officeIds&&void 0!=e.officeTree&&e.officeTree.length>0){var n=t.officeIds.split(","),r=[];void 0!=e.officeTree&&e.officeTree.length>0&&Object(s.a)(e.officeTree,r),void 0!=e.$refs.treeOffice&&e.$refs.treeOffice.setCheckedKeys(_.difference(n,r))}})})})}},initObject:{id:this.formId},hasPermission:{save:{isShow:!0,isPermission:!0},back:{isShow:!0,isPermission:!0}},formObject:{dataScope:"1",useable:"1",sysData:"1"},columns:[{label:"归属部门",value:"officeId",name:"officeName",type:"tree",tree:{isMultiple:!1,defaultProps:{id:"id",children:"children",label:"name"},treeMethod:"office_getOfficeTree",treeObject:{type:"",extId:""},treeData:[]}},{label:"角色名称",value:"name",type:"input",disHid:!1,disabled:!1,rule:[{required:!0,message:"角色名称不能为空"},{min:0,max:64,message:"角色名称必须介于 0 到 64 之间",trigger:"blur"}]},{label:"英文名称",value:"enname",type:"input",tooltipContent:"工作流用户组标识",rule:[{required:!0,message:"英文名称不能为空"},{validator:n.e({validateMethod:"role_nameValidate",name:"英文名称",keyField:"enname",fileId:this.formId}),trigger:"blur"}],disHid:!1,disabled:!1},{label:"角色类型",value:"roleType",type:"select",tooltipContent:"工作流组用户组类型（任务分配：assignment、管理角色：security-role、普通角色：user）",disHid:!1,disabled:!1,dict:{dictType:"",dictData:[{value:"assignment",label:"任务分配"},{value:"security-role",label:"管理角色"},{value:"user",label:"普通角色"}]}},{label:"是否系统数据",value:"sysData",type:"select",disHid:!1,disabled:!1,tooltipContent:"“是”代表此数据只有超级管理员能进行修改，“否”则表示拥有角色修改人员的权限都能进行修改",dict:{dictType:"yes_no",dictData:[]}},{label:"是否可用",value:"useable",type:"select",slotName:"icon",tooltipContent:"“是”代表此数据可用，“否”则表示此数据不可用",dict:{dictType:"yes_no",dictData:[]}},{label:"角色授权",value:"roleAuthor",type:"slot",slotName:"roleAuthor"},{label:"备注",value:"remarks",type:"textarea",disHid:!1,disabled:!1}],formChildInfo:[]},menuTree:[],officeTree:[]}},created:function(){this.formId||this.$store.dispatch("menu_getMenuTree","1")},computed:{treeData:function(){return this.$store.state.menu.menuTree},officetreeData:function(){return this.$store.state.office.officeTree}},methods:{goBack:function(){this.$emit("goBack")},handleCheckChange:function(e,t,o){var i=this.$refs.treeRole.getCheckedKeys(),s=(i=this.$refs.treeRole.getHalfCheckedKeys().concat(i)).join(",");this.option.formObject.menuIds=s},handleCheckOfficeChange:function(e,t,o){var i=this.$refs.treeOffice.getCheckedKeys(),s=(i=this.$refs.treeOffice.getHalfCheckedKeys().concat(i)).join(",");this.option.formObject.officeIds=s}}},a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("form-file",{attrs:{option:e.option},on:{goBack:e.goBack}},[o("template",{slot:"roleAuthor"},[o("el-col",{staticStyle:{width:"100%"},attrs:{span:12}}),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"角色授权:"}},[o("el-tree",{ref:"treeRole",attrs:{data:e.treeData,props:e.defaultProps,"show-checkbox":"","node-key":"id","default-expand-all":""},on:{"check-change":e.handleCheckChange}})],1)],1),e._v(" "),o("el-col",{directives:[{name:"show",rawName:"v-show",value:"9"==e.option.formObject.dataScope,expression:"option.formObject.dataScope == '9'"}],attrs:{span:12}},[o("el-tree",{ref:"treeOffice",attrs:{data:e.officetreeData,props:e.defaultOfficeProps,"show-checkbox":"","node-key":"id","default-expand-all":""},on:{"check-change":e.handleCheckOfficeChange}})],1)],1)],2)},staticRenderFns:[]},l=o("C7Lr")(r,a,!1,null,null,null).exports,c={data:function(){return{filterText:"",officeUserList:[],adduserList:[],office:{title:"",id:""},defaultProps:{children:"children",label:"name"}}},props:{userList:{type:Array},formId:{type:String}},created:function(){this.$store.dispatch("office_getOfficeTree",{type:"",extId:""})},watch:{filterText:function(e){this.$refs.tree2.filter(e)}},computed:{roleDialog:function(){return this.$store.state.dialog.roleDialog},treeData:function(){return this.$store.state.office.officeTree}},methods:{handleClose:function(e){this.$store.dispatch("toggleRole")},submit:function(){for(var e=this,t=[],o=0;o<this.adduserList.length;o++)t.push(this.adduserList[o].id);var i={userIds:t,roleId:this.formId};this.$confirm("您确定要分配已选人员吗？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$store.dispatch("role_assignRole",i).then(function(t){t&&"200"==t.code?(e.$message({message:t.message||"分配成功",showClose:!0,type:"success",dangerouslyUseHTMLString:!0,duration:3e3}),e.adduserList.splice(0),e.$emit("assignRoleUser","100")):e.$message({message:t.message,showClose:!0,type:"error",duration:3e3}),e.$store.dispatch("toggleRole")})}).catch(function(){})},clear:function(){var e=this;this.$confirm("您确定要清除已选人员吗？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.adduserList.splice(0)}).catch(function(){})},toggleRole:function(){this.$store.dispatch("toggleRole")},filterNode:function(e,t){return!e||-1!==t.title.indexOf(e)},getCurrentOffice:function(e,t){this.office=e},getUserList:function(e,t){var o=this,i=e.id;this.$store.dispatch("role_getUserByOffice",i).then(function(){o.officeUserList=o.$store.state.role.officeUserList})},fpUser:function(e){for(var t=0;t<this.adduserList.length;t++)if(this.adduserList[t].id===e.userId)return;this.adduserList.push({id:e.userId,name:e.userName,flag:!1})}}},f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:"分配角色",modal:!1,visible:e.roleDialog,width:"30%",top:"10vh","before-close":e.handleClose},on:{"update:visible":function(t){e.roleDialog=t}}},[o("el-tree",{ref:"tree2",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.getUserList,"current-change":e.getCurrentOffice}}),e._v(" "),o("div",{staticClass:"dxUser",staticStyle:{margin:"10px 0"}},[o("span",[e._v("待选人员:")]),o("br"),e._v(" "),e._l(e.officeUserList,function(t,i){return[o("span",{key:i,staticStyle:{cursor:"pointer",display:"block"},on:{click:function(o){return e.fpUser(t)}}},[e._v(e._s(t.userName))])]})],2),e._v(" "),o("div",{staticClass:"yxUser",staticStyle:{margin:"10px 0"}},[o("span",[e._v("已选人员:")]),o("br"),e._v(" "),e._l(e.userList,function(t){return[o("span",{key:t.name,staticStyle:{color:"red",cursor:"pointer",display:"block"}},[e._v(e._s(t.name))])]}),e._v(" "),e._l(e.adduserList,function(t,i){return[o("span",{key:i,staticStyle:{display:"block"}},[e._v(e._s(t.name))])]})],2),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("span",{staticStyle:{float:"left","font-size":"12px"}},[e._v("通过选择部门，然后为列出的人员分配角色。")]),e._v(" "),o("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submit()}}},[e._v("确认分配")]),e._v(" "),o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.clear}},[e._v("清除已选")]),e._v(" "),o("el-button",{attrs:{type:"warning",size:"mini"},on:{click:e.toggleRole}},[e._v("关 闭")])],1)],1)},staticRenderFns:[]},d=o("C7Lr")(c,f,!1,null,null,null).exports,u={name:"roleAssign",props:{formId:{type:String,default:""}},components:{treeRole:d,quickTable:i.a},data:function(){return{option:{selection:!1,showIndex:!0,tableMenu:!0,isPage:!1,name:"角色",apiName:"roleAssign",searchObject:{id:this.formId},hasPermission:{edit:{isShow:!1,isPermission:!1},del:{isShow:!1,isPermission:!1}},columns:[{label:"归属部门",prop:"officeName"},{label:"登录名",prop:"loginName"},{label:"姓名",prop:"name"},{label:"电话",prop:"phone"},{label:"手机",prop:"mobile"}]},roleInfo:{name:"",enname:"",remarks:""}}},created:function(){var e=this;this.$store.dispatch("role_getRoleInfo",this.formId).then(function(){e.roleInfo=e.$store.state.role.roleInfo})},computed:{userList:function(){return this.$store.state.role.userList}},methods:{substring:function(e,t){return e.length>t?e.substring(0,t)+"...":e},getAssignUser:function(e){"100"===e&&this.$refs.quickTable.getList()},removeUser:function(e,t){var o=this;this.$confirm("确认要将用户["+t.name+"]从["+this.roleInfo.name+"]角色中移除吗？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={userId:t.id,roleId:o.roleInfo.id};o.$store.dispatch("role_outroleAssign",e).then(function(e){e&&"200"==e.code?(o.$message({message:"移除成功",showClose:!0,type:"success",duration:3e3}),o.$refs.quickTable.getList()):o.$message({message:e.message,showClose:!0,type:"error",duration:3e3})})}).catch(function(){})},assignRole:function(){this.$store.dispatch("toggleRole")}}},m={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{},[o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("div",{staticClass:"roleText"},[e._v("角色名称:\n        "),o("b",[e._v(e._s(e.roleInfo.name))])])]),e._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"roleText"},[e._v("归属部门: "+e._s(e.roleInfo.officeName))])]),e._v(" "),o("el-col",{attrs:{span:5,title:e.roleInfo.enname}},[o("div",{staticClass:"roleText"},[e._v("英文名称: "+e._s(e.roleInfo.enname))])]),e._v(" "),o("el-col",{attrs:{span:5,title:e.roleInfo.roleType}},[o("div",{staticClass:"roleText"},[e._v("角色类型: "+e._s(e.roleInfo.roleType))])])],1),e._v(" "),o("div",{staticStyle:{margin:"20px 0"}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-share",size:"mini"},on:{click:function(t){return e.assignRole()}}},[e._v("分配角色")]),e._v(" "),o("tree-role",{attrs:{userList:e.userList,formId:e.formId},on:{assignRoleUser:e.getAssignUser}})],1),e._v(" "),o("quick-table",{ref:"quickTable",attrs:{option:e.option},scopedSlots:e._u([{key:"menuTop",fn:function(t){var i=t.row,s=t.index;return[o("el-button",{attrs:{type:"danger",icon:"el-icon-minus",size:"mini"},on:{click:function(t){return e.removeUser(s,i)}}},[e._v("移除")])]}}])})],1)},staticRenderFns:[]};var p=o("C7Lr")(u,m,!1,function(e){o("rCsx")},"data-v-46da5252",null).exports,h=o("ANQr"),g={name:"roleList",components:{quickTable:i.a,roleForm:l,roleAssign:p,baseButton:h.a},data:function(){return{option:{selection:!1,showIndex:!0,tableMenu:!0,isPage:!1,activeName:"role",operWidth:300,formId:"",parentId:"",name:"角色",apiName:"role",searchObject:{},hasPermission:{edit:{isShow:!0,isPermission:!1},del:{isShow:!0,isPermission:!1}},columns:[{label:"角色名称",prop:"name",isClick:!0},{label:"英文名称",prop:"enname",isClick:!0},{label:"归属部门",prop:"officeName"}]},hasPermission:!1}},created:function(){var e=this;this.$store.dispatch("hasPermission","sys:role:edit").then(function(){e.hasPermission=e.$store.state.common.hasPermission,e.option.hasPermission.edit.isPermission=e.hasPermission,e.option.hasPermission.del.isPermission=e.hasPermission})},computed:{},methods:{assignRole:function(e){this.option.formId=e.id,this.option.activeName="roleAssign"},goBack:function(){this.option.formId="",this.option.activeName="role",this.$refs.quickTable.getList()},handleClick:function(e,t){"role"==e.name&&(this.option.formId="")}}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{},[o("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.option.activeName,callback:function(t){e.$set(e.option,"activeName",t)},expression:"option.activeName"}},[o("el-tab-pane",{attrs:{label:"角色列表",name:"role"}},[o("quick-table",{ref:"quickTable",attrs:{option:e.option},scopedSlots:e._u([{key:"menuTop",fn:function(t){var i=t.row;return[e.hasPermission?o("base-button",{attrs:{type:"success",icon:"el-icon-share",size:"mini",content:"分配"},on:{buttonEvent:function(t){return e.assignRole(i)}}}):e._e()]}}])})],1),e._v(" "),"roleAssign"!=e.option.activeName?o("el-tab-pane",{attrs:{label:""==e.option.formId?"角色添加":"角色编辑",name:"roleform"}},["roleform"==e.option.activeName?o("role-form",{attrs:{formId:e.option.formId},on:{goBack:e.goBack}}):e._e()],1):e._e(),e._v(" "),"roleAssign"==e.option.activeName?o("el-tab-pane",{attrs:{label:"角色分配",name:"roleAssign"}},["roleAssign"==e.option.activeName?o("role-assign",{attrs:{formId:e.option.formId}}):e._e()],1):e._e()],1)],1)},staticRenderFns:[]},b=o("C7Lr")(g,v,!1,null,null,null);t.default=b.exports},rCsx:function(e,t){}});