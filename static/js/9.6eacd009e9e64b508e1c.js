webpackJsonp([9],{"/gJQ":function(e,t){},"C/fY":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={name:"scheduleList",components:{commonList:i("G1U3").a},data:function(){return{}},created:function(){}},o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-container"},[t("common-list",{attrs:{type:"schedule"}})],1)},staticRenderFns:[]},s=i("C7Lr")(a,o,!1,null,null,null);t.default=s.exports},G1U3:function(e,t,i){"use strict";var a=i("ANQr"),o=i("0qgA"),s=i("gnUw"),r=(i("w3CS"),i("oAV5")),n=i("TIfe"),l=i("LUZf"),c=i("aA9S"),d=i.n(c),u=i("c/w/"),f=i("BD2p"),m=i("35Vf"),p={components:{quickTable:o.a,quickForm:v,quickdialog:m.a,baseButton:a.a,tree:u.a,upload:f.a},props:{dataList:{type:Array,default:function(){return[]}},type:{type:String,default:""},scheduleId:{type:String,default:""},readOnly:{type:Boolean,default:!1}},data:function(){return{dialogOption:{title:"确认",childObject:{impleOfficeName:"",confirmDate:""},index:0,disabled:!1,userId:Object(n.a)(l.a.userId),childArray:[{label:"参与人部门",value:"officeName",type:"input",disabled:!0},{label:"参与人",value:"userName",type:"input",disabled:!0},{label:"确认状态",value:"status",type:"select",disabled:!0,dict:{dictType:"",dictData:[{label:"未确认",value:"0"},{label:"已确认",value:"1"}],tags:[{label:"danger",value:"0"},{label:"success",value:"1"}]}},{label:"确认日期",value:"confirmDate",formatDate:"yyyy-MM-dd",type:"date",rule:[{required:!0,message:"确认日期不能为空",trigger:"change"}],disabled:!1},{label:"附件",value:"filePath",type:"upload",disabled:!1}]},option:{formId:"",readOnly:!1,isPage:!1,apiName:"bill",isOper:!!this.scheduleId&&"my"==this.type&&!this.readOnly,tableList:this.dataList,hasPermission:{edit:{isShow:!1,isPermission:!0},del:{isShow:!1,isPermission:!0}},columns:[{label:"参与人部门",prop:"officeName"},{label:"参与人",prop:"userName"},{label:"确认状态",prop:"status",dict:{dictType:"",dictData:[{label:"未确认",value:"0"},{label:"已确认",value:"1"}],tags:[{label:"danger",value:"0"},{label:"success",value:"1"}]}},{label:"确认日期",formatDate:"yyyy-MM-dd",prop:"confirmDate"}]}}},computed:{},created:function(){},methods:{openConfirm:function(e,t){var i=this;this.$confirm("您确定要确认这条日程安排吗？","操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.dialogOption.childObject=d()({},_.cloneDeep(e),{confirmDate:Object(r.g)(new Date,"yyyy-MM-dd")}),i.dialogOption.index=t,i.confirm()}).catch(function(){})},lookConfirm:function(e,t){this.dialogOption.childObject=_.cloneDeep(e),this.dialogOption.disabled=!0,this.dialogOption.index=t,this.dialogOption.childArray[3].disabled=!0,this.dialogOption.childArray[4].disabled=!0,this.$refs.quickdialog.toggle_dialog()},confirm:function(e){var t=this,i=d()({},this.dialogOption.childObject,{scheduleId:this.scheduleId,status:"1"});this.$store.dispatch("schedule_confirm",i).then(function(e){e&&"200"==e.code?(t.$message({message:"确认成功",showClose:!0,type:"success",duration:3e3}),t.$set(t.dataList,t.dialogOption.index,i)):t.$message({message:e.message||"获取失败",showClose:!0,type:"error",duration:3e3})})}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"form_title",staticStyle:{width:"100%"}},[e._v("参与人列表")]),e._v(" "),i("quick-table",{ref:"quickTable",attrs:{option:e.option},scopedSlots:e._u([{key:"menuTop",fn:function(t){var a=t.row,o=t.index;return["0"==a.status&&"my"==e.type&&a.userId==e.dialogOption.userId?i("base-button",{attrs:{type:"warning",icon:"el-icon-check",size:"mini",content:"确认"},on:{buttonEvent:function(t){return e.openConfirm(a,o)}}}):e._e()]}}])}),e._v(" "),i("quickdialog",{ref:"quickdialog",attrs:{option:e.dialogOption},on:{submit:function(t){return e.confirm()}}})],1)},staticRenderFns:[]},b=i("C7Lr")(p,h,!1,null,null,null).exports,y={name:"scheduleform",components:{quickForm:s.a,formconfirm:b},props:{formId:{type:String,default:""},readOnly:{type:Boolean,default:!1},isConfirm:{type:Boolean,default:!1},type:{type:String,default:""}},watch:{statuss:{handler:function(e,t){void 0==e&&(this.option.columns[8].value="0"),this.option.columns[9].disHid="1"!=e},deep:!0}},created:function(){},computed:{statuss:function(){return this.option.formObject.status}},data:function(){var e=this;return{option:{name:"日程安排",apiName:"schedule",labelWidth:"120px",initObject:{id:this.formId},callback:{},hasPermission:{save:{isShow:!this.readOnly&&!this.isConfirm,isPermission:!0},back:{isShow:!0,isPermission:!0}},columns:[{label:"标题",value:"title",type:"input",maxlength:64,disabled:this.readOnly||this.isConfirm,rule:[{required:!0,message:"标题不能为空",trigger:"change"}]},{label:"填写人",value:"userName",placeholder:"自动带出",type:"input",disabled:!0,rule:[{required:!0,message:"填写人不能为空",trigger:"change"}]},{label:"所属部门",value:"officeName",placeholder:"自动带出",type:"input",disabled:!0,rule:[{required:!0,message:"所属部门不能为空",trigger:"change"}]},{label:"填写日期",value:"createDate",type:"input",disabled:!0,rule:[{required:!0,message:"填写日期不能为空",trigger:"change"}]},{label:"预计发生日期",value:"dueDate",type:"date",disabled:this.readOnly||this.isConfirm,pickerOptions:{identifier:"NowAndAfter"},rule:[{required:!0,message:"预计发生日期不能为空",trigger:"change"}]},{label:"参与人",value:"pullIds",name:"pullNames",type:"tree",disabled:this.readOnly||this.isConfirm,callback:function(t,i,a){e.$set(a.formObject,i.name,e.arrayToString(t,"name")),e.$set(a.formObject,i.value,e.arrayToString(t,"id")),a.formObject.pullList.splice(0);for(var o=0;o<t.length;o++)a.formObject.pullList.push({officeId:t[o].officeId,officeName:t[o].officeName,userName:t[o].name,userId:t[o].id,status:"0",confirmDate:"",filePath:""})},tree:{isMultiple:!0,filter:{isFilter:!0},treeMethod:"office_getOfficeUserTree",treeObject:{isUser:!0},treeData:[]}},{label:"状态",value:"status",type:"select",disabled:!0,dict:{dictType:"schedule_status",dictData:[]}},{label:"详情",value:"remarks",type:"textarea",disabled:this.readOnly||this.isConfirm,rule:[{required:!0,message:"详情不能为空",trigger:"change"}]},{label:"附件",value:"filePath",type:"upload",disabled:this.readOnly||this.isConfirm},{label:"废弃理由",value:"reason",type:"textarea",disHid:!0,disabled:!0}],formObject:{title:Object(r.g)(new Date,"yyyy-MM-dd")+"_"+Object(n.a)(l.a.officeName)+"_"+Object(n.a)(l.a.realName)+"的日程安排",userId:Object(n.a)(l.a.userId),userName:Object(n.a)(l.a.realName),officeId:Object(n.a)(l.a.officeId),officeName:Object(n.a)(l.a.officeName),createDate:Object(r.g)(new Date,"yyyy-MM-dd"),dueDate:Object(r.g)(new Date,"yyyy-MM-dd"),pullIds:"",pullNames:"",pullList:[],status:"0",reason:"",filePath:""}}}},methods:{goBack:function(){this.$route.params.row?this.$router.go(-1):(this.$emit("goBack"),this.$store.dispatch("navbar_GetCount"))}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"scheduleform"},[i("quick-form",{attrs:{option:e.option},on:{goBack:e.goBack}},[i("template",{slot:"childrenafter"},[e.option.formObject.pullList&&e.option.formObject.pullList.length>0?i("formconfirm",{attrs:{dataList:e.option.formObject.pullList,scheduleId:e.formId,type:e.type,readOnly:e.readOnly}}):e._e()],1)],2)],1)},staticRenderFns:[]},v=i("C7Lr")(y,g,!1,null,null,null).exports,O={name:"scheduleList",components:{quickTable:o.a,quickForm:v,baseButton:a.a},props:{type:{type:String,default:"my"}},data:function(){return{isform:"my"==this.type,option:{activeName:"schedule",formId:"",readOnly:!1,isConfirm:!1,name:"日程安排",apiName:"schedule",userId:Object(n.a)(l.a.userId),hasPermission:{edit:{isShow:"my"==this.type,isPermission:!1},del:{isShow:!1,isPermission:!0}},columns:[{label:"标题",prop:"title",width:320},{label:"填写人",prop:"userName"},{label:"所属部门",prop:"officeName"},{label:"预计发生日期",formatDate:"yyyy-MM-dd",prop:"dueDate"},{label:"状态",prop:"status",dict:{dictType:"schedule_status",dictData:[],tags:[{label:"success",value:"0"},{label:"warning",value:"1"}]}},{label:"参与人",prop:"pullNames"}],searchObject:{userId:"my"==this.type?this.userId:"",pageNo:1,pageSize:15},searchColums:[{label:"所属部门",value:"officeId",name:"officeName",type:"tree",disHid:"my"==this.type,tree:{treeMethod:"office_getOfficeTree",treeObject:{type:"",extId:""},treeData:[]}},{label:"填写人",value:"createId",name:"userName",type:"tree",disHid:"my"==this.type,tree:{filter:{isFilter:!0},treeMethod:"office_getOfficeUserTree",treeObject:{isUser:!0},treeData:[]}},{label:"标题",value:"title",type:"input"},{label:"预计发生日期",value:"daterange",type:"daterange"}]},dialogFormVisible:!1,form:{id:"",reason:""},rules:{reason:[{required:!0,message:"废弃理由不能为空",trigger:"blur"},,{min:0,max:500,message:"废弃理由最大长度500",trigger:"blur"}]}}},computed:{formLabel:function(){return this.option.formId?this.option.readOnly?"日程安排查看":this.option.isConfirm?"日程安排确认":"日程安排编辑":"日程安排添加"},userId:function(){return Object(n.a)(l.a.userId)}},created:function(){this.option.searchObject.userId="my"==this.type?this.userId:"",this.$route.params.row&&this.confirmRow(this.$route.params.row)},methods:{exportRow:function(e){this.$message({message:"功能正在开发中",showClose:!0,type:"warning",duration:3e3})},goBack:function(){this.reset(),this.option.activeName="schedule"},handleClick:function(e,t){"schedule"==e.name&&this.reset()},reset:function(){this.option.formId="",this.option.readOnly=!1,this.option.isConfirm=!1,this.isform="my"==this.type,this.$route.params.row=void 0,this.$refs.quickTable.getList()},editRow:function(e){this.option.formId=e.id,this.isform=!0,this.option.activeName="scheduleform"},lookRow:function(e){this.option.formId=e.id,this.option.readOnly=!0,this.isform=!0,this.option.activeName="scheduleform"},confirmRow:function(e){this.option.formId=e.id,this.option.isConfirm=!0,this.isform=!0,this.option.activeName="scheduleform"},part:function(e){if(e.pullIds){var t=e.pullIds.split(",").indexOf(this.option.userId);return e.pullIds.split(",").indexOf(this.option.userId)>=0&&"1"!=e.confirmStatus.split(",")[t]}return!1},dialogFormShow:function(e){this.dialogFormVisible=!0,this.form.id=e.id},getBack:function(e){this.dialogFormVisible=!1,this.form.reason="",this.$refs[e].resetFields()},deleteRow:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.$store.dispatch("schedule_discard",{id:t.form.id,reason:t.form.reason}).then(function(e){e&&"200"==e.code?(t.dialogFormVisible=!1,t.form.reason="",t.$message({message:"废弃成功",showClose:!0,type:"success",duration:3e3}),t.$refs.quickTable.getList(),t.$store.dispatch("navbar_GetCount")):t.$message({message:e.message||"获取失败",showClose:!0,type:"error",duration:3e3})})})}}},I={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.option.activeName,callback:function(t){e.$set(e.option,"activeName",t)},expression:"option.activeName"}},[i("el-tab-pane",{attrs:{label:"日程安排列表",name:"schedule"}},[i("quick-table",{ref:"quickTable",attrs:{option:e.option},scopedSlots:e._u([{key:"menuTop",fn:function(t){var a=t.row;return["schedule"==e.type?[i("base-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini",content:"查看"},on:{buttonEvent:function(t){return e.lookRow(a)}}})]:[e.part(a)&&"1"!=a.status?[i("base-button",{attrs:{type:"warning",icon:"el-icon-check",size:"mini",content:"确认"},on:{buttonEvent:function(t){return e.confirmRow(a)}}})]:[i("base-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini",content:"查看"},on:{buttonEvent:function(t){return e.lookRow(a)}}})],e._v(" "),a.userId==e.userId&&"1"!=a.status?i("base-button",{attrs:{type:"warning",icon:"el-icon-close",size:"mini",content:"废弃"},on:{buttonEvent:function(t){return e.dialogFormShow(a)}}}):e._e()]]}}])})],1),e._v(" "),e.isform?i("el-tab-pane",{attrs:{label:e.formLabel,name:"scheduleform"}},["scheduleform"==e.option.activeName?i("quick-form",{attrs:{type:e.type,readOnly:e.option.readOnly,isConfirm:e.option.isConfirm,formId:e.option.formId},on:{goBack:e.goBack}}):e._e()],1):e._e(),e._v(" "),i("el-dialog",{attrs:{title:"废弃",visible:e.dialogFormVisible,center:""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:"废弃理由",prop:"reason"}},[i("el-input",{attrs:{type:"textarea",rows:"6","auto-complete":"off",onKeypress:"javascript:if(event.keyCode==32)event.returnValue=false;"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteRow("form")}}},[e._v("保 存")]),e._v(" "),i("el-button",{on:{click:function(t){return e.getBack("form")}}},[e._v("返 回")])],1)],1)],1)],1)])},staticRenderFns:[]};var k=i("C7Lr")(O,I,!1,function(e){i("/gJQ")},null,null);t.a=k.exports}});