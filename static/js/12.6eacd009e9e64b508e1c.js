webpackJsonp([12],{"+Qo4":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={name:"myList",components:{commonList:i("3rUt").a},data:function(){return{}},created:function(){}},o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-container"},[t("common-list",{attrs:{type:"my"}})],1)},staticRenderFns:[]},r=i("C7Lr")(a,o,!1,null,null,null);t.default=r.exports},"3rUt":function(e,t,i){"use strict";var a=i("ANQr"),o=i("0qgA"),r=i("3cXf"),s=i.n(r),n=i("gnUw"),l=(i("w3CS"),i("oAV5")),c=i("TIfe"),d=i("LUZf"),m=i("BD2p"),p={name:"logsform",components:{quickForm:n.a,upload:m.a},props:{formId:{type:String,default:""},readOnly:{type:Boolean,default:!1},type:{type:String,default:""}},data:function(){return{time:"",option:{name:"工作日志",apiName:"logs",initObject:{id:this.formId},callback:{},hasPermission:{save:{isShow:!this.readOnly,isPermission:!0},back:{isShow:!0,isPermission:!0}},columns:[{label:"日志标题",value:"title",type:"input",maxlength:64,disabled:this.readOnly,rule:[{required:!0,message:"日志标题不能为空",trigger:"change"}]},{label:"填写人",value:"userName",placeholder:"自动带出",type:"input",disabled:!0,rule:[{required:!0,message:"填写人不能为空",trigger:"change"}]},{label:"所属部门",value:"officeName",placeholder:"自动带出",type:"input",disabled:!0,rule:[{required:!0,message:"所属部门不能为空",trigger:"change"}]},{label:"填写日期",value:"createDate",type:"input",disabled:!0,rule:[{required:!0,message:"填写日期不能为空",trigger:"change"}]},{label:"汇报日期",value:"reportDate",type:"date",disabled:this.readOnly,pickerOptions:{identifier:"Before"},rule:[{required:!0,message:"汇报日期不能为空",trigger:"change"}]}],formObject:{id:this.$route.params.id,title:(this.$route.params.date||Object(l.g)(new Date,"yyyy-MM-dd"))+"_"+Object(c.a)(d.a.officeName)+"_"+Object(c.a)(d.a.realName)+"的工作日志",userId:Object(c.a)(d.a.userId),userName:Object(c.a)(d.a.realName),officeId:Object(c.a)(d.a.officeId),officeName:Object(c.a)(d.a.officeName),createDate:Object(l.g)(new Date,"yyyy-MM-dd"),reportDate:this.$route.params.date||Object(l.g)(new Date,"yyyy-MM-dd"),dailyTasks:[],files:""},formChildInfo:[{childTitle:"任务明细",childEnName:"dailyTask",dialogField:!1,dialogTitle:"任务明细",indexField:0,labelWidth:"120px",disabled:this.readOnly,delInterface:{useInt:!1,delMethod:"",delObject:{}},childObject:{protocolId:"",protocolName:"",percentComplete:0,remarks:""},childArray:[{label:"业务名称",value:"protocolId",name:"protocolName",type:"tree",style:"width:90%",tree:{treeMethod:"protocol_tree",treeObject:{},treeData:[]}},{label:"任务完成度",labelUnit:"(%)",value:"percentComplete",type:"inputNumber",precision:0,rule:[{required:!0,message:"任务完成度不能为空",trigger:"blur"}]},{label:"工作描述",value:"remarks",type:"textarea",rule:[{required:!0,message:"工作描述不能为空",trigger:"blur"},{min:0,max:500,message:"工作描述长度必须介于 0 到 500 之间",trigger:"blur"}]}]}]}}},created:function(){},mounted:function(){var e=this;"my"!=this.type||this.readOnly||(window.timer=setInterval(function(){e.temp()},6e4))},beforeDestroy:function(){"my"==this.type&&clearInterval(window.timer)},computed:{},methods:{temp:function(){var e=this,t=_.cloneDeep(this.option.formObject);t.dailyTasks=s()(t.dailyTasks),this.$refs.quickform.$refs.ruleForm.validate(function(i){if(!i)return console.log("表单验证失败"),!1;e.$store.dispatch("logs_temp",t).then(function(t){t&&"200"==t.code?(e.option.formObject.id=t.data.id,e.time=t.data.time,e.$notify({title:e.formId?"更新成功":"保存成功",message:"执行时间为："+t.data.time,offset:100,duration:1e4,type:"success"})):e.$notify({title:e.formId?"更新失败":"保存失败",message:t.message||"获取失败",offset:100,duration:1e4,type:"error"})})})},goBack:function(){this.$route.params.date?this.$router.go(-1):this.$emit("goBack")}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"logsform"},[i("quick-form",{ref:"quickform",attrs:{option:e.option},on:{goBack:e.goBack}},[i("template",{slot:"childrenafter"},[i("div",{staticClass:"form_title",staticStyle:{width:"100%"}},[e._v("工作附件")]),e._v(" "),i("el-row",{attrs:{gutter:12}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"工作附件:","label-width":"100px"}},[i("upload",{attrs:{fileType:"all",disabled:e.readOnly,limit:100},model:{value:e.option.formObject.files,callback:function(t){e.$set(e.option.formObject,"files","string"==typeof t?t.trim():t)},expression:"option.formObject.files"}})],1)],1)],1)],1)],2)],1)},staticRenderFns:[]},f=i("C7Lr")(p,u,!1,null,null,null).exports,h={name:"logsList",components:{quickTable:o.a,quickForm:f,baseButton:a.a},props:{type:{type:String,default:"my"}},data:function(){return{isform:"my"==this.type,option:{activeName:"logs",formId:"",readOnly:!1,isExport:"logs"==this.type,exportTitle:"导出",exportFileName:"工作日志.xls",exportIcon:"el-icon-upload2",exportMethod:"logs_export",name:"工作日志",apiName:"logs",hasPermission:{edit:{isShow:!1,isPermission:!0},del:{isShow:"my"==this.type,isPermission:!0}},columns:[{label:"标题",prop:"title",width:400},{label:"填写人",prop:"userName"},{label:"所属部门",prop:"officeName"},{label:"汇报日期",formatDate:"yyyy-MM-dd",prop:"reportDate"},{label:"填写日期",formatDate:"yyyy-MM-dd",prop:"createDate"}],searchObject:{userId:"my"==this.type?this.userId:"",officeId:"",officeName:"",daterange:[],pageNo:1,pageSize:15},searchColums:[{label:"所属部门",value:"officeId",name:"officeName",type:"tree",disHid:"my"==this.type,tree:{treeMethod:"office_getOfficeTree",treeObject:{type:"",extId:""},treeData:[]}},{label:"填写人",value:"userId",name:"userName",type:"tree",disHid:"my"==this.type,tree:{filter:{isFilter:!0},treeMethod:"office_getOfficeUserTree",treeObject:{isUser:!0},treeData:[]}},{label:"标题",value:"title",type:"input"},{label:"汇报日期",value:"daterange",type:"daterange"}]}}},computed:{formLabel:function(){return this.option.formId?this.option.readOnly?"工作日志查看":"工作日志编辑":"工作日志添加"},userId:function(){return Object(c.a)(d.a.userId)}},created:function(){this.$route.params.form&&(this.$route.params.id&&"1"==this.$route.params.status?this.lookRow({id:this.$route.params.id}):this.option.activeName="logsform"),"my"==this.type?this.option.searchObject.userId=this.userId:"logs"==this.type&&(this.option.searchObject.officeName=Object(c.a)(d.a.officeName),this.option.searchObject.officeId=Object(c.a)(d.a.officeId))},methods:{exportRow:function(e){this.$message({message:"功能正在开发中",showClose:!0,type:"warning",duration:3e3})},goBack:function(){this.option.activeName="logs",this.reset()},handleClick:function(e,t){"logs"==e.name&&this.reset()},reset:function(){this.option.formId="",this.option.readOnly=!1,this.isform="my"==this.type,this.$route.params.date=void 0,this.$refs.quickTable.getList()},editRow:function(e){this.option.formId=e.id,this.isform=!0,this.option.activeName="logsform"},lookRow:function(e){this.option.formId=e.id,this.option.readOnly=!0,this.isform=!0,this.option.activeName="logsform"}}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.option.activeName,callback:function(t){e.$set(e.option,"activeName",t)},expression:"option.activeName"}},[i("el-tab-pane",{attrs:{label:"工作日志列表",name:"logs"}},[i("quick-table",{ref:"quickTable",attrs:{option:e.option},scopedSlots:e._u([{key:"menuTop",fn:function(t){var a=t.row;return["logs"==e.type?[i("base-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini",content:"查看"},on:{buttonEvent:function(t){return e.lookRow(a)}}})]:[i("base-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",content:"编辑"},on:{buttonEvent:function(t){return e.editRow(a)}}})]]}}])})],1),e._v(" "),e.isform?i("el-tab-pane",{attrs:{label:e.formLabel,name:"logsform"}},["logsform"==e.option.activeName?i("quick-form",{attrs:{type:e.type,readOnly:e.option.readOnly,formId:e.option.formId},on:{goBack:e.goBack}}):e._e()],1):e._e()],1)],1)])},staticRenderFns:[]},b=i("C7Lr")(h,y,!1,null,null,null);t.a=b.exports}});